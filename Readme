This is the new version of the contraction code.
